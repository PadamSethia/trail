{% extends 'base.html' %}
{% block content %}

<!-- TODO : Some issue with Math logic , doesn't fill the actual row , but the next one . Happens only for the first two .
        May be due to the fact that the fucction changes when we hit add more , so the logic is no more therer for the previous row .
        Find to persist the logic for rows even after addition of more fields.
-->

<div class="container" style="margin-top: 5rem;">

    <div class="columns is-mobile is-centered">
        <div class="column is-three-quarters">
            <nav class="level is-mobile">
                <div class="level-left">

                    <div class="level-item">
                        <p class="is-size-5 ">
                            <span class=" robo"> Transaction <span class="icon icon-btn"
                                    style="padding:3px; margin-left: 10px;"><i
                                        data-feather="hash"></i></span>{{ pp_num }}</span></span></p>
                    </div>
                </div>
                <div class="level-right">
                    <div class="field is-grouped">
                        <div class="control">
                            <a href="{{ url_for('trans_a_view')}}" class=" button is-black"><span
                                    class="icon icon-btn-in"><i data-feather="edit-2"></i></span>Edit</a>
                        </div>
                        <div class="control">

                            <a href="{{ url_for('trans_a_view')}}" class=" button is-black"><span
                                    class="icon icon-btn-in"><i data-feather="corner-up-left"></i></span>Back</a>
                        </div>
                    </div>
                </div>

            </nav>
            <hr>
            <div class="">

                <div class="form">
                    <form id="trans_a_form_id">
                        <div class="field-body is-horizontal">
                            <div class="field">
                                <label class="label">Product Order No.</label>
                                <div class="control has-icons-left">
                                    <input class="input robo" name="PP_no" value="{{pp_num}}" readonly>
                                    <span class="icon icon-btn-in is-left">
                                        <i data-feather="hash"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label">Start Date</label>
                                <div class="control has-icons-left">
                                    <input class="input" name="start-dates">
                                    <span class="icon is-small is-left">
                                        <i data-feather="calendar"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label">Target Date</label>
                                <div class="control has-icons-left">
                                    <input class="input" name="target-dates">
                                    <span class="icon is-small is-left">
                                        <i data-feather="calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="field-body is-horizontal">
                            <div class="field">
                                <label class="label">Product</label>
                                <div class="control is-fullwidth select">
                                    <select id="prod_sel" name="prod_sel"></select>
                                </div>
                            </div>
                            <script>
                                $(document).ready(function () {
                                    var options = [];
                                    $.getJSON("{{url_for('get_fin_prod')}}", function (result) {
                                        var leng = Object.keys(result).length
                                        for (var i = 0; i < leng; i++) {
                                            options.push('<option value="',
                                                Object.keys(result)[i], '">',
                                                Object.values(result)[i], '</option>');
                                        }
                                        $("#prod_sel").html(options.join(''));
                                        // $("#prod_sel").prop("selectedIndex", 0);

                                        // var pp_sel = $("#prod_sel").val()
                                        // $.getJSON("/get/uom/" + pp_sel, function (result) {
                                        //     console.log(result)
                                        //     $("#prod_uom").val(result);
                                        // });

                                    });
                                })
                            </script>
                            <div class="field">
                                <label class="label">Prog. Qty</label>
                                <div class="control">
                                    <input class="input" name="prog_qty">

                                </div>
                            </div>

                            <div class="field">
                                <label class="label">U.O.M</label>
                                <div class="control">
                                    <input class="input robo" id="prod_uom" name="prod_uom" readonly>


                                </div>
                            </div>
                            <div class="field">
                                <label class="label">Original Sample</label>
                                <div class="control">
                                    <label class="radio">
                                        <input type="radio" name="samp_iss" value="yes">
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="samp_iss" value="no">
                                        No
                                    </label>

                                </div>
                            </div>

                        </div>
                        <hr>
                        <div class="field is-horizontal">
                            <div class="field-label is-normal">
                                <label class="label">Programme By</label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <p class="control is-expanded has-icons-left">
                                        <input class="input" type="text" placeholder="Name" name="prog_by">
                                        <span class="icon  is-left">
                                            <i data-feather="user"></i>
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="field is-horizontal">
                            <div class="field-label is-normal">
                                <label class="label">Size/Design </label>
                            </div>
                            <div class="field-body" id="size_fld">
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="s_0" placeholder="Size">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="s_1" placeholder="Size">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="s_2" placeholder="Size">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="s_3" placeholder="Size">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="s_4" placeholder="Size">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="s_5" placeholder="Size">
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="field is-horizontal">
                            <div class="field-label is-normal">
                                <label class="label">Qty </label>
                            </div>
                            <div class="field-body" id="qty_fld">
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="q_0" placeholder="Qty">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="q_1" placeholder="Qty">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="q_2" placeholder="Qty">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="q_3" placeholder="Qty">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="q_4" placeholder="Qty">
                                    </p>
                                </div>
                                <div class="field">
                                    <p class="control is-expanded">
                                        <input class="input" type="text" name="q_5" placeholder="Qty">
                                    </p>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <p class="robo">Raw Material Required</p>
                        <br>

                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fabric</th>
                                    <th>U.O.M</th>
                                    <th>Per Pc. Consum.</th>
                                    <th>Qty Required</th>
                                    <th>Qty Issued</th>
                                    <th>Qty Return</th>
                                    <th>Net Consum.</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody class="input_fields_wrap_fab">
                                <tr>
                                    <td>
                                        <div class="select"><select id="fab_selector" class="fab_sel_cls"
                                                name="fab_sel[0]">

                                            </select>
                                        </div>
                                    </td>
                                    <td><input type="text" class="input" name="fab_sel_uom[0]" readonly></td>
                                    <td><input type="text" class="input" name="fab_pr_pc[0]" /></td>
                                    <td><input type="text" class="input" name="fab_qty_req[0]" /></td>
                                    <td><input type="text" class="input" name="fab_qty_iss[0]" /></td>
                                    <td><input type="text" class="input" name="fab_qty_ret[0]" /></td>
                                    <td><input type="text" class="input" name="fab_net_con[0]" /></td>
                                    <td></td>
                                </tr>
                                <script>
                                    $(document).ready(function () {
                                        var options = [];
                                        $.getJSON("{{url_for('get_raw_prod')}}", function (result) {
                                            var leng = Object.keys(result).length
                                            for (var i = 0; i < leng; i++) {
                                                options.push('<option value="',
                                                    Object.keys(result)[i], '">',
                                                    Object.values(result)[i], '</option>');
                                            }
                                            $(".fab_sel_cls").html(options.join(''));
                                            // $(".fab_sel_cls").prop("selectedIndex", 0);
                                            // var pp_sel = $("select[name='fab_sel[0]']").val()
                                            // $.getJSON("/get/uom/raw_fab/" + pp_sel, function (result) {
                                            //     $("input[name='fab_sel_uom[0]']").val(result);
                                            // });

                                        });
                                    });

                                </script>
                                <script>
                                    $("select[name='fab_sel[0]']").on('change', function () {
                                        var pp_sel = $("select[name='fab_sel[0]']").val()
                                        $.getJSON("/get/uom/raw_fab/" + pp_sel, function (result) {
                                            $("input[name='fab_sel_uom[0]']").val(result);
                                        });
                                    })
                                </script>
                            </tbody>
                        </table>
                        <button id="add_field_button_fab" style="display: none;" class=" button is-primary"><span
                                class="icon icon-btn-in"><i data-feather="plus"></i></span>Add More</button>


                        <br>

                        <br>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Accessories</th>
                                    <th>U.O.M</th>

                                    <th>Per Pc. Consum.</th>
                                    <th>Qty Required</th>
                                    <th>Qty Issued</th>
                                    <th>Qty Return</th>
                                    <th>Net Consum.</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody class="input_fields_wrap_acc">
                                <tr>
                                    <td>
                                        <div class="select"><select id="acc_seletion" class="acc_selector"
                                                name="acc_sel[0]">

                                            </select>
                                        </div>
                                    </td>
                                    <td><input type="text" class="input" name="acc_sel_uom[0]" readonly></td>
                                    <td><input type="text" class="input" name="acc_pr_pc[0]" /></td>
                                    <td><input type="text" class="input" name="acc_qty_req[0]" /></td>
                                    <td><input type="text" class="input" name="acc_qty_iss[0]" /></td>
                                    <td><input type="text" class="input" name="acc_qty_ret[0]" /></td>
                                    <td><input type="text" class="input" name="acc_net_con[0]" /></td>
                                    <td></td>
                                </tr>
                                <script>
                                    $(document).ready(function () {
                                        var options = [];
                                        $.getJSON("{{url_for('get_acc')}}", function (result) {
                                            for (var j = 0; j < Object.keys(result).length; j++) {
                                                options.push('<option value="',
                                                    Object.keys(result)[j], '">',
                                                    Object.values(result)[j], '</option>');
                                            }
                                            $(".acc_selector").html(options.join(''));
                                            // $(".acc_selector").prop("selectedIndex", 0);
                                            // var pp_sel = $("select[name='acc_sel[0]']").val()

                                            // $.getJSON("/get/uom/acc/" + pp_sel, function (result) {
                                            //     $("input[name='acc_sel_uom[0]']").val(result);
                                            // });
                                        });

                                    })
                                </script>
                            </tbody>
                        </table>
                        <button id="add_field_button_acc" style="display: none;" class=" button is-primary"><span
                                class="icon icon-btn-in"><i data-feather="plus"></i></span>Add More</button>


                        <br>
                        <br>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Other Materials</th>
                                    <th>U.O.M</th>

                                    <th>Per Pc. Consum.</th>
                                    <th>Qty Required</th>
                                    <th>Qty Issued</th>
                                    <th>Qty Return</th>
                                    <th>Net Consum.</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody class="input_fields_wrap_oth">
                                <tr>
                                    <td>
                                        <div class="select"><select class="oth_selector" name="oth_sel[0]">

                                            </select>
                                        </div>
                                    </td>
                                    <td><input type="text" class="input" name="oth_pr_uom[0]" readonly></td>
                                    <td><input type="text" class="input" name="oth_pr_pc[0]" /></td>
                                    <td><input type="text" class="input" name="oth_qty_req[0]" /></td>
                                    <td><input type="text" class="input" name="oth_qty_iss[0]" /></td>
                                    <td><input type="text" class="input" name="oth_qty_ret[0]" /></td>
                                    <td><input type="text" class="input" name="oth_net_con[0]" /></td>
                                    <td></td>
                                </tr>
                                <script>
                                    $(document).ready(function () {
                                        var options = [];
                                        $.getJSON("{{url_for('get_oth_mat')}}", function (result) {
                                            for (var j = 0; j < Object.keys(result).length; j++) {
                                                options.push('<option value="',
                                                    Object.keys(result)[j], '">',
                                                    Object.values(result)[j], '</option>');
                                            }
                                            $(".oth_selector").html(options.join(''));
                                            // $(".oth_selector").prop("selectedIndex", 0);
                                            // var pp_sel = $("select[name='oth_sel[0]']").val()

                                            // $.getJSON("/get/uom/oth/" + pp_sel, function (result) {
                                            //     $("input[name='oth_pr_uom[0]']").val(result);
                                            // });
                                        });
                                    })
                                </script>
                            </tbody>
                        </table>
                        <button id="add_field_button_oth" style="display: none;" class=" button is-primary"><span
                                class="icon icon-btn-in"><i data-feather="plus"></i></span>Add More</button>


                        <br>
                        <br>
                        <hr>
                        <div class="field is-grouped">
                            <div class="control">
                                <button id="submit_btn_trans_a" class="button is-black"><span
                                        class="icon icon-btn-in"><i data-feather="check"></i></span>Save</button>
                            </div>
                            <div class="control">
                            </div>
                            <div class="control ">
                                <a class="button is-text">Clear Fields</a>
                            </div>

                        </div>

                    </form>
                </div>
            </div>
        </div>


    </div>

</div>

<br>
<br>

<script>

    $('#submit_btn_trans_a').click(function (e) {
        e.preventDefault();
        var formdata = $("#trans_a_form_id").serializeJSON();

        var data = { 'pp_num': '{{pp_num}}', 'data': formdata };


        $.ajax({
            url: "{{url_for('trans_a')}}",
            type: 'POST',
            data: JSON.stringify(data),
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            async: false,
            success: function (msg) {
                window.location.href = "{{url_for('trans_a')}}";
            }
        });

    });
</script>
<script>



    $(document).ready(function () {
        $('input[name*="dates"]').daterangepicker({
            "locale": {
                "format": "DD/MM/YYYY"
            }, "singleDatePicker": true, buttonClasses: 'button', applyButtonClasses: 'is-primary', cancelButtonClasses: 'is-text'
        });

        var max_fields = 10; //maximum input boxes allowed
        var wrapper_fab = $(".input_fields_wrap_fab"); //Fields wrapper
        var add_button_fab = $("#add_field_button_fab"); //Add button ID

        var x = 0; //initlal text box count
        $(add_button_fab).click(function (e) { //on add input button click
            console.log("clicked")
            e.preventDefault();
            if (x < max_fields) { //max input box allowed
                x++; //text box increment
                $(wrapper_fab).append('<tr> \
                    <td><div class="select"><select  class="fab_sel_cls" name="fab_sel['+ x + ']"></select></div></td>\
                    <td><input type="text" class="input" name="fab_sel_uom['+ x + ']" readonly></td>\
                    <td><input type="text" class="input" name="fab_pr_pc['+ x + ']"/></td>\
                    <td><input type="text" class="input" name="fab_qty_req['+ x + ']"/></td> \
                    <td><input type = "text" class= "input" name = "fab_qty_iss['+ x + ']" /></td>\
                    <td><input type="text" class="input" name="fab_qty_ret['+ x + ']" /></td>\
                    <td><input type="text" class="input" name="fab_net_con['+ x + ']" /></td>\
                    </tr> ');
                feather.replace();

                $("input[name='fab_pr_pc[" + x + "]']").keyup(function () {
                    var prog_qty = parseFloat($('input[name="prog_qty"]').val());
                    var per_pc = parseFloat($("input[name='fab_pr_pc[" + x + "]']").val())
                    var total = prog_qty * per_pc;
                    $("input[name='fab_qty_req[" + x + "]']").val(total);
                });

                $("input[name='fab_qty_ret[" + x + "]']").keyup(function () {
                    var qty_iss = parseFloat($('input[name="fab_qty_iss[' + x + ']"]').val());

                    var qty_ret = parseFloat($("input[name='fab_qty_ret[" + x + "]']").val())
                    var total = qty_iss - qty_ret;
                    $("input[name='fab_net_con[" + x + "]']").val(total);
                });

                $("select[name='fab_sel[" + x + "]']").on('change', function () {

                    var pp_sel = $("select[name='fab_sel[" + x + "]']").val()
                    $.getJSON("/get/uom/raw_fab/" + pp_sel, function (result) {
                        $("input[name='fab_sel_uom[" + x + "]']").val(result);
                    });
                })

                var options = [];

                $.getJSON("{{url_for('get_raw_prod')}}", function (result) {
                    for (var j = 0; j < Object.keys(result).length; j++) {
                        options.push('<option value="',
                            Object.keys(result)[j], '">',
                            Object.values(result)[j], '</option>');
                    }
                    $("select[name='fab_sel[" + x + "]']").html(options.join(''));
                    // $("select[name='fab_sel[" + x + "]']").prop("selectedIndex", 0);
                    // var pp_sel = $("select[name='fab_sel[" + x + "]']").val()
                    // $.getJSON("/get/uom/raw_fab/" + pp_sel, function (result) {
                    //     $("input[name='fab_sel_uom[" + x + "]']").val(result);
                    // });


                });
            }


        });

        $(wrapper_fab).on("click", ".remove_field", function (e) { //user click on remove text
            e.preventDefault();
            $(this).parent('td').parent('tr').remove(); x--;
        })
    });


    $(document).ready(function () {
        var max_fields = 10; //maximum input boxes allowed
        var wrapper_acc = $(".input_fields_wrap_acc"); //Fields wrapper
        var add_button_acc = $("#add_field_button_acc"); //Add button ID

        var x = 0; //initlal text box count
        $(add_button_acc).click(function (e) { //on add input button click
            console.log("clicked")
            e.preventDefault();
            if (x < max_fields) { //max input box allowed
                x++; //text box increment
                $(wrapper_acc).append('<tr> \
                    <td><div class="select"><select class="acc_selector" name="acc_sel['+ x + ']"></select></div></td>\
                    <td><input type="text" class="input" name="acc_sel_uom['+ x + ']" readonly></td> \
                    <td><input type="text" class="input" name="acc_pr_pc['+ x + ']"/></td>\
                    <td><input type="text" class="input" name="acc_qty_req['+ x + ']"/></td> \
                    <td><input type = "text" class= "input" name = "acc_qty_iss['+ x + ']" /></td>\
                    <td><input type="text" class="input" name="acc_qty_ret['+ x + ']" /></td>\
                    <td><input type="text" class="input" name="acc_net_con['+ x + ']" /></td>\
                    </tr> ');
                feather.replace();

                var options = [];
                $.getJSON("{{url_for('get_acc')}}", function (result) {
                    for (var j = 0; j < Object.keys(result).length; j++) {
                        options.push('<option value="',
                            Object.keys(result)[j], '">',
                            Object.values(result)[j], '</option>');
                    }
                    $(".acc_selector_" + x + "").html(options.join(''));

                    $("select[name='acc_sel[" + x + "]']").html(options.join(''));
                    // $("select[name='acc_sel[" + x + "]']").prop("selectedIndex", 0);
                    var pp_sel = $("select[name='acc_sel[" + x + "]']").val();

                    $.getJSON("/get/uom/acc/" + pp_sel, function (result) {
                        $("input[name='acc_sel_uom[" + x + "]']").val(result);
                    });
                });

                // Calc Logic

                $("input[name='acc_pr_pc[" + x + "]']").keyup(function () {
                    var prog_qty = parseFloat($('input[name="prog_qty"]').val());
                    var per_pc = parseFloat($("input[name='acc_pr_pc[" + x + "]']").val())
                    var total = prog_qty * per_pc;
                    $("input[name='acc_qty_req[" + x + "]']").val(total);
                });

                $("input[name='acc_qty_ret[" + x + "]']").keyup(function () {
                    var qty_iss = parseFloat($('input[name="acc_qty_iss[' + x + ']"]').val());

                    var qty_ret = parseFloat($("input[name='acc_qty_ret[" + x + "]']").val())
                    var total = qty_iss - qty_ret
                    $("input[name='acc_net_con[" + x + "]']").val(total);
                });

                $("select[name='acc_sel[" + x + "]']").on('change', function () {

                    var pp_sel = $("select[name='acc_sel[" + x + "]']").val()
                    $.getJSON("/get/uom/acc/" + pp_sel, function (result) {
                        $("input[name='acc_sel_uom[" + x + "]']").val(result);
                    });
                })

                // End Calc Login


            }




        });

        $(wrapper_acc).on("click", ".remove_field", function (e) { //user click on remove text
            e.preventDefault();
            $(this).parent('td').parent('tr').remove(); x--;
        })
    });


    $(document).ready(function () {
        var max_fields = 10; //maximum input boxes allowed
        var wrapper_oth = $(".input_fields_wrap_oth"); //Fields wrapper
        var add_button_oth = $("#add_field_button_oth"); //Add button ID

        var x = 0; //initlal text box count
        $(add_button_oth).click(function (e) { //on add input button click
            console.log("clicked")
            e.preventDefault();
            if (x < max_fields) { //max input box allowed
                x++; //text box increment
                $(wrapper_oth).append('<tr> \
                    <td><div class="select"><select class="oth_selector" name="oth_sel['+ x + ']"></select></div></td>\
                    <td><input type="text" class="input" name="oth_pr_uom['+ x + ']" readonly></td>\
                    <td><input type="text" class="input" name="oth_pr_pc['+ x + ']"/></td>\
                    <td><input type="text" class="input" name="oth_qty_req['+ x + ']"/></td> \
                    <td><input type = "text" class= "input" name = "oth_qty_iss['+ x + ']" /></td>\
                    <td><input type="text" class="input" name="oth_qty_ret['+ x + ']" /></td>\
                    <td><input type="text" class="input" name="oth_net_con['+ x + ']" /></td>\
                    </tr> ');
                feather.replace();

                // Math Login
                $("input[name='oth_pr_pc[" + x + "]']").keyup(function () {
                    var prog_qty = parseFloat($('input[name="prog_qty"]').val());
                    var per_pc = parseFloat($("input[name='oth_pr_pc[" + x + "]']").val())
                    var total = prog_qty * per_pc;
                    $("input[name='oth_qty_req[" + x + "]']").val(total);
                });

                $("input[name='oth_qty_ret[" + x + "]']").keyup(function () {
                    var qty_iss = parseFloat($('input[name="oth_qty_iss[' + x + ']"]').val());

                    var qty_ret = parseFloat($("input[name='oth_qty_ret[" + x + "]']").val())
                    var total = qty_iss - qty_ret
                    $("input[name='oth_net_con[" + x + "]']").val(total);
                });


                $("select[name='oth_sel[" + x + "]']").on('change', function () {
                    var pp_sel = $("select[name='oth_sel[" + x + "]']").val()
                    $.getJSON("/get/uom/oth/" + pp_sel, function (result) {
                        $("input[name='oth_pr__uom[" + x + "]']").val(result);
                    });
                })

                // End Math Logic

                var options = [];
                $.getJSON("{{url_for('get_oth_mat')}}", function (result) {
                    for (var j = 0; j < Object.keys(result).length; j++) {
                        options.push('<option value="',
                            Object.keys(result)[j], '">',
                            Object.values(result)[j], '</option>');
                    }
                    $("select[name='oth_sel[" + x + "]']").html(options.join(''));
                    // $("select[name='oth_sel[" + x + "]']").prop("selectedIndex", 0);
                    // var pp_sel = $("select[name='oth_sel[" + x + "]']").val()
                    // $.getJSON("/get/uom/oth/" + pp_sel, function (result) {
                    //     $("input[name='oth_pr_uom[" + x + "]']").val(result);
                    // });
                });

            }

        });

        $(wrapper_oth).on("click", ".remove_field", function (e) { //user click on remove text
            e.preventDefault();
            $(this).parent('td').parent('tr').remove(); x--;
        })
    });
</script>

<!-- Script for Math Logic -->

<script>

    $("input[name='acc_pr_pc[0]']").keyup(function () {
        var prog_qty = parseFloat($('input[name="prog_qty"]').val());

        var per_pc = parseFloat($("input[name='acc_pr_pc[0]']").val())
        var total = prog_qty * per_pc;
        $("input[name='acc_qty_req[0]']").val(total);
    });

    $("input[name='acc_qty_ret[0]']").keyup(function () {
        var qty_iss = parseFloat($('input[name="acc_qty_iss[0]"]').val());

        var qty_ret = parseFloat($("input[name='acc_qty_ret[0]']").val())
        var total = qty_iss - qty_ret
        $("input[name='acc_net_con[0]']").val(total);
    });


    $("input[name='oth_pr_pc[0]']").keyup(function () {
        var prog_qty = parseFloat($('input[name="prog_qty"]').val());

        var per_pc = parseFloat($("input[name='oth_pr_pc[0]']").val())
        var total = prog_qty * per_pc;
        $("input[name='oth_qty_req[0]']").val(total);
    });

    $("input[name='oth_qty_ret[0]']").keyup(function () {
        var qty_iss = parseFloat($('input[name="oth_qty_iss[0]"]').val());

        var qty_ret = parseFloat($("input[name='oth_qty_ret[0]']").val())
        var total = qty_iss - qty_ret
        $("input[name='oth_net_con[0]']").val(total);
    });


    $("input[name='fab_pr_pc[0]']").keyup(function () {
        var prog_qty = parseFloat($('input[name="prog_qty"]').val());

        var per_pc = parseFloat($("input[name='fab_pr_pc[0]']").val())
        var total = prog_qty * per_pc;
        $("input[name='fab_qty_req[0]']").val(total);
    });

    $("input[name='fab_qty_ret[0]']").keyup(function () {
        var qty_iss = parseFloat($('input[name="fab_qty_iss[0]"]').val());

        var qty_ret = parseFloat($("input[name='fab_qty_ret[0]']").val())
        var total = qty_iss - qty_ret
        $("input[name='fab_net_con[0]']").val(total);
    });
</script>
<script>
    $(document).ready(function () {
        $.ajaxSetup({
            async: false
        });

        var part_a;
        $.getJSON("{{url_for('trans_a_api' ,trans_id = pp_num)}}", function (result) {

            part_a = $.parseJSON(result['trans_data']['part_a']);

            console.log(part_a);
            if ($.isEmptyObject(result)) {

                console.log('Boy , its empty ');
                $('#trans_b_form').trigger("reset");

            }
            else {
                console.log('Boy , its full ');

                var extra_fld_fab = Object.keys(part_a['fab_sel']).length;
                for (i = 1; i < extra_fld_fab; i++) {
                    $("#add_field_button_fab").trigger('click');
                }

                var extra_fld_acc = Object.keys(part_a['acc_sel']).length;
                for (i = 1; i < extra_fld_acc; i++) {
                    $("#add_field_button_acc").trigger('click');
                }
                var extra_fld_oth = Object.keys(part_a['oth_sel']).length;
                for (i = 1; i < extra_fld_oth; i++) {
                    $("#add_field_button_oth").trigger('click');
                }
            };






        });
        console.log('#1');
        populate('#trans_a_form_id', json2html_name_list(part_a));

        console.log('#2');
        function json2html_name_list(json, result, parent) {
            if (!result) result = {};
            if (!parent) parent = '';
            if ((typeof json) != 'object') {
                result[parent] = json;
            } else {
                for (var key in json) {
                    var value = json[key];
                    if (parent == '') var subparent = key;
                    else var subparent = parent + '[' + key + ']';
                    result = json2html_name_list(value, result, subparent);
                }
            }
            return result;
        }

        //  Populates all the fields

        function populate(frm, data) {
            $.each(data, function (key, value) {

                $('[name="' + key + '"]', frm).val(value);
                $("select[name='" + key + "']").prop("option", value);


                console.log(key + '-----' + value);
            });
        }

    });


    // Fucnction for JSON to html fillups





</script>
<script>


</script>
{% endblock %}